version: "3.7"
# convenient compose file for Self-hosted LiveSync.
# Initial Author: @arminus
# Modified      : @vrtmrz
services:
    nginx-proxy:
        image: nginxproxy/nginx-proxy:alpine
        ports:
            - 19778:80
        environment:
            # 代理路径
            - VIRTUAL_PATH=/e=_/
            - VIRTUAL_DEST=/
        restart: always

    couchserver:
        image: couchdb:3.1.2
        ports:
            - 15984:5984
        environment:
            - COUCHDB_USER=${COUCHDB_USER}
            - COUCHDB_PASSWORD=${COUCHDB_PW}
        volumes:
            # The files' owner will be id:5984 when you launch the image.
            # Because CouchDB writes on-the-fly configurations into local.ini.
            # So when you want to perform git pull or change something, you have to change owners back.
            - ./data/couchdb:/opt/couchdb/data
            - ./conf/local.ini:/opt/couchdb/etc/local.ini
        restart: always
